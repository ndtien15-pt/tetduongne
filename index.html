<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy New Year 2026 - Real Glow Texture</title>
    <style>
        body {
            margin: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        canvas { display: block; }
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.8);
            z-index: 10; transition: opacity 0.5s;
        }
        button {
            padding: 20px 40px; font-size: 20px;
            background: transparent; color: #fff;
            border: 2px solid #fff; cursor: pointer;
            text-transform: uppercase; letter-spacing: 3px;
        }
        button:hover { background: #fff; color: #000; box-shadow: 0 0 20px white; }
    </style>
</head>
<body>

<div id="overlay">
    <button id="btn-start">Bắn Pháo Hoa</button>
</div>
<audio id="audio" src="music.mp3"></audio>
<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // --- BÍ MẬT 1: TẠO TEXTURE ĐỐM SÁNG (GLOW SPRITE) ---
    // Thay vì tải ảnh, ta tự vẽ 1 cái ảnh đốm sáng ảo trong bộ nhớ
    const particleCanvas = document.createElement('canvas');
    const particleCtx = particleCanvas.getContext('2d');
    particleCanvas.width = 32;
    particleCanvas.height = 32;

    // Vẽ một hình tròn mờ dần từ tâm ra ngoài (Gradient)
    const gradient = particleCtx.createRadialGradient(16, 16, 0, 16, 16, 16);
    gradient.addColorStop(0, 'rgba(255, 255, 255, 1)'); // Tâm trắng xóa
    gradient.addColorStop(0.4, 'rgba(255, 255, 255, 0.3)'); // Giữa mờ
    gradient.addColorStop(1, 'rgba(255, 255, 255, 0)'); // Ngoài cùng trong suốt
    
    particleCtx.fillStyle = gradient;
    particleCtx.fillRect(0, 0, 32, 32);

    // --- CẤU HÌNH ---
    let fireworks = [];
    let particles = [];
    let texts = [];
    const textSequence = ["5", "4", "3", "2", "1", "HAPPY", "NEW YEAR", "2026"];
    let textIndex = 0;

    // --- CLASS PARTICLES (DÙNG ẢNH GLOW) ---
    class Spark {
        constructor(x, y, hue) {
            this.x = x;
            this.y = y;
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 5 + 1; // Nổ ngẫu nhiên
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.hue = hue;
            this.life = 1; // Tuổi thọ
            this.gravity = 0.05; // Trọng lực nhẹ
            this.friction = 0.96; // Cản gió
            this.size = Math.random() * 20 + 10; // Kích thước đốm sáng
        }

        update() {
            this.vx *= this.friction;
            this.vy *= this.friction;
            this.vy += this.gravity;
            this.x += this.vx;
            this.y += this.vy;
            this.life -= 0.015; // Mờ dần
            this.size *= 0.98; // Nhỏ dần
        }

        draw() {
            ctx.globalAlpha = this.life;
            // Thay đổi màu cho cái ảnh đốm sáng
            // Mẹo: Dùng filter để đổi màu ảnh
            // Nhưng để nhanh, ta dùng globalCompositeOperation 'lighter' bên dưới
            
            // Vẽ cái ảnh đốm sáng ra thay vì vẽ hình tròn
            // Trừ đi 1 nửa size để vẽ từ tâm
            ctx.drawImage(particleCanvas, this.x - this.size/2, this.y - this.size/2, this.size, this.size);
        }
    }

    class Firework {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = canvas.height;
            this.targetY = Math.random() * (canvas.height / 2.5);
            this.speed = Math.random() * 3 + 10;
            this.hue = Math.random() * 360;
            this.exploded = false;
        }

        update() {
            this.y -= this.speed;
            this.speed *= 0.95;
            if(this.speed < 2 || this.y < this.targetY) this.explode();
        }

        draw() {
            if(!this.exploded) {
                ctx.globalAlpha = 1;
                ctx.fillStyle = `hsl(${this.hue}, 100%, 50%)`;
                ctx.fillRect(this.x, this.y, 3, 10); // Vẽ tia bay lên
            }
        }

        explode() {
            this.exploded = true;
            for(let i=0; i<100; i++) {
                particles.push(new Spark(this.x, this.y, this.hue));
            }
        }
    }

    // --- CHỮ DẠNG ĐỐM SÁNG ---
    class TextDot {
        constructor(x, y) {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.targetX = x;
            this.targetY = y;
            this.size = 15; // Đốm chữ to hơn chút
            this.life = Math.random();
        }
        update() {
            this.x += (this.targetX - this.x) * 0.1;
            this.y += (this.targetY - this.y) * 0.1;
        }
        draw() {
            // Chữ màu trắng vàng (Gold)
            ctx.globalAlpha = 0.8; 
            ctx.drawImage(particleCanvas, this.x - this.size/2, this.y - this.size/2, this.size, this.size);
        }
    }

    function initText(str) {
        texts = [];
        ctx.clearRect(0,0,canvas.width, canvas.height);
        ctx.font = "900 150px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(str, canvas.width/2, canvas.height/2);
        
        const data = ctx.getImageData(0,0,canvas.width, canvas.height).data;
        // Gap lớn hơn vì đốm sáng to
        for(let y=0; y<canvas.height; y+=10){ 
            for(let x=0; x<canvas.width; x+=10){
                if(data[(y*canvas.width+x)*4+3] > 128) {
                    texts.push(new TextDot(x, y));
                }
            }
        }
    }

    // --- MAIN LOOP ---
    function animate() {
        requestAnimationFrame(animate);
        
        // Xóa màn hình nhưng giữ lại vệt (Trail)
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // BÍ MẬT 2: LIGHT BLENDING (HÒA TRỘN ÁNH SÁNG)
        // Lệnh này làm các đốm sáng chồng lên nhau sẽ rực rỡ hơn
        ctx.globalCompositeOperation = 'lighter';

        // Vẽ chữ
        texts.forEach(t => { t.update(); t.draw(); });

        // Vẽ Pháo
        if(textIndex >= textSequence.length - 1 && Math.random() < 0.05) {
            fireworks.push(new Firework());
        }

        fireworks.forEach((fw, i) => {
            fw.update(); fw.draw();
            if(fw.exploded) fireworks.splice(i, 1);
        });

        particles.forEach((p, i) => {
            p.update(); p.draw();
            if(p.life <= 0) particles.splice(i, 1);
        });
    }

    // Logic
    function next() {
        if(textIndex < textSequence.length) {
            initText(textSequence[textIndex]);
            textIndex++;
            setTimeout(next, 1200);
        }
    }

    document.getElementById('btn-start').addEventListener('click', () => {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('audio').play().catch(()=>{});
        initText(textSequence[0]);
        animate();
        setTimeout(next, 1000);
    });
    
    window.addEventListener('resize', ()=> {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

</script>
</body>
</html>